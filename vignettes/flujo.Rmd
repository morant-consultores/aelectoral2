---
title: "flujo"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{flujo}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(dplyr)
library(purrr)
```

En esta viñeta se desarolla el *happy path* para generar todos los insumos requeridos para generar un tablero electoral desde aelectoral. 

### Vectores base

```{r}
elecciones <- c("gb_17", "pm_18", "dl_18", "df_18", "pm_21", "df_21", "dl_21")
partidos <- c("morena", "pan", "pri", "mc", "prd", "total")
```


### Insumos
* Base de datos por partido con todos los datos en términos absolutos y ganador por elección

Dada la nueva configuración de aelectoral2 crear una clase requiere que se tenga claridad de cuáles son los partidos 
para los que se desea el análisis. Sin embargo, en primera instancia no es necesario incluirlo. 
```{r}
bd <- Electoral$new("pm_15", entidad = "mex")
bd <- Electoral$new("pm_15", entidad = "mex", partidos = partidos)
bd$partido("pm_15")
bd$voto_relativo("bd_partido", "pm_15")
bd$calcular_ganador("bd_partido", "pm_15")

elecciones |> 
  walk(~{
    bd$agregar_bd(.x)
    bd$partido(.x)
    bd$voto_relativo("bd_partido", .x)
    bd$calcular_ganador("bd_partido", .x)
  })

bd$colapsar_base("bd_partido")
```

* Columnas de índice, degradado y quantiles

```{r}
#Creación del objeto de colores
bd$colores_nombrados()

# Cálculo del índice
bd$obtener_indice_completo("bd_partido")

bd$bd_partido |> 
  glimpse()
```

* Label para leaflet



